## 스프링 데이터 JPA 사용

#### JPA 란? (Java Persistence API)

> 자바객체와 데이터베이스 테이블 간의 매핑을 처리하는 **ORM 기술의 표준** 

> 각 기능의 동작이 어떻게 되어야 한다는 것을 기술한 기술 명세 

ORM : 객체와 관계를 설정하는 것, 객체와 RDBMS를 매핑시키는 개념

JPA는 기술 명세이기때문에 이 기술명세에 따라 실제로 기능을 구현한 구현체가 필요함. --> Hibernate, EclipseLink 등등 --> JPA 프로바이더 

- 장점
  - 개발이 편리
    - 기본적인 CRUD용 SQL 직접 작성할 필요없음 
  - 데이터베이스에 독립적인 개발이 가능
    - 데이터베이스에 종속적이지 않음. 
    - 데이터베이스가 변경되더라도 JPA가 해당 데이터베이스에 맞는 쿼리를 생성해줌 
  - 유지보수가 쉽다
    - 테이블이 변경되어도 JPA의 앤티티(객체)만 수정하면 됨.
- 단점
  - learning curve가 크다
    - SQL을 직접적으로 작성하지 않으므로 튜님할때도 어려움
  - 특정 데이터베이스의 기능을 사용할 수 없다. 
  - 객체지향 설계가 필요 



#### 스프링 데이터 JPA 

- JPA를 스프링에서 쉽게 사용할 수 있도록 도와주는 프레임워크
- 내부적으로 Hibernate를 사용하여 구현하였다. 
- repository 라는 인터페이스 제공 --> 해당 인터페이스만 상속받아 정해진 규칙에 맞게 메서드를 작성하면 개발자가 작성해야 할 코드가 완성됨. 



#### 기본 설정 

1. JPA 설정 추가 

   application.properties 설정 추가 

   Database 설정 클래스에 Bean 등록

2. 자바8의 날짜 API설정

   자바7이하에서 문제되었던 시간관련 클래스가 추가됨 --> JSR-310

   설정없이 사용하면 mysql 버전에 따라 문제 발생 가능 --> Jsr310JpaConverters 적용하여 해결 

   

#### 엔티티 생성 

- 기존에는 BoardDto, BoardFileDto를 사용함 

- `@Entity` 어노테이션 사용 --> 해당 클래스가 JPA의 엔티티임을 나타냄 
- 엔티티 클래스는 테이블과 매핑됨 
- `@id` --> 엔티티의 PK 나타냄 



#### Jpa 컨트롤러 생성 

- `/jpa` 를 붙여 URI 작성 
- repository 사용하여 작성



#### 뷰 생성

- jpa를 위한 뷰 생성 
- `th:text="|${list.originalFileName}(${#numbers.formatInteger(list.fileSize/1000,1,'DEFAULT')} kb)|"` : 마이바티스는 쿼리에서 첨부파일의 크기를 계산했지만 JPA는 쿼리를 작성하지 않기 때문에 화면에서 첨부파일의 크기를 변경해서 보여줘야한다.



#### Repository 생성

- 스프링데이터 JPA가 제공하는 인터페이스